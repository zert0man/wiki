# Команды CRUD в MongoDB

В данном руководстве приведены ОЧЕНЬ краткие сведения. Смело используйте документацию для получения дополнительной информации и примеров.

## Кратко о структуре базы

На сервере MongoDB может быть размещено несколько баз данных.

`use mydatabase` - выбор текущей базы. `mydatabase` - имя вашей базы. Если базы не существует, она будет создана. После выполнения `use` создается специальный объект с именем `db`, через который осуществляется доступ к текущей базе.

Список всх команд, которые можно выполнить с базой, можно получить, используя команду `db.help()`.

Каждая база состоит из коллекций документов. Коллекция - это аналог таблицы в реляционной СУБД. Главным отличием является отсутствие фиксированного списка колонок. Команда `db.getCollectionNames()` позоляет получить список всех коллекций в базе.Обратиться к операциям конкретной коллекции `collectionname` можно так: `db.collectionname`.

Коллекции состоят из документов. Документ - это аналог записи в реляционной СУБД. Документ содержит произвольный набор полей, в том числе некоторые из них могут быть объектами и массивами. Кажый документ обязательно содержит поле `_id`, значение которого должно быть уникальным в пределах коллекции. После создания записи изменить значение этого поля нельзя. Вы можете сами создавать это поле. Если при создании записи вы не указали значение поля `_id`, то оно будет сгенерированно автоматически.
  
## Вставка

[Подробная документация](http://docs.mongodb.org/manual/reference/method/db.collection.insert)

`db.collectionname`.insert(doc)` - добавляет один или несколько документов в коллекцию. Документ должен быть представлен в формате JSON.

Например:

```
db.unicorns.insert({
	name: 'Aurora', 
	gender: 'f', 
	weight: 450})
```

## Выборка запсей

[Документация на русском](http://jsman.ru/mongo-book/Glava-3-Osvaivaem-Find.html)

[Подробная документация](http://docs.mongodb.org/manual/reference/method/db.collection.find/)

`db.collectionname.find(query, projection)` - упрощенный аналог SQL-оператора `select`. Параметр `query` задает условие выборки; `projection` - список полей в выборке.

Пример: вывести список имен единорогов, которые весять больше 50.

```
db.unicorns.count(
	{
		weight: {$gt: 50}
	},
	{
		id:0,
		name:1
	})
```

Результат выборки представляется в виде специального объекта - курсора. Этот объект предоставляет возможности навигации по выборке.

Описание методов курсора вы модете найти в [документации](http://docs.mongodb.org/manual/reference/method/js-cursor/).

## Изменение

[Подробная документация](http://docs.mongodb.org/manual/reference/method/db.collection.update)

 `db.collection.update(query, update, options)` - изменяет документы, удовлетворяющие условию `query` (аналогично тому, что используется в `find`).
 
 Параметр `update` может содержать:
- документ, на который будут заменены все найденные документы,
- описание изменения документа с помощью операторов `$inc` и `$set`.
 
Пример изменения записи с `_id=1`:

```
db.books.update(
   { _id: 1 },
   {
     $inc: { stock: 5 },
     $set: {
       item: "ABC123",
       "info.publisher": "2222",
       tags: [ "software" ],
       "ratings.1": { by: "xyz", rating: 3 }
     }
   }
)
```

## Удаление

[Подробная документация](http://docs.mongodb.org/manual/reference/method/db.collection.remove)

`db.collectionname.remove(query)` - удаляет документы, соответствующие условию. Параметр `query` аналогичен соответствующему параметру в методе `find()`.

Пример удаления всех записей в коллекции:

```
db.unicorns.remove( { } )
```

Пример удаления толстых единорогов (всех, у кого вес больше 300):

```
db.unicorns.remove( { weight: { $gt: 300 } } )
```
