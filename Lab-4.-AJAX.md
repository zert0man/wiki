# Лабораторная работа 4. AJAX

## Цели работы

- Познакомиться с технологией AJAX.
- Изучить библиотеку JQuery.

## Задание

1. Реализовать AJAX-загрузку различных фрагментов страницы.
1. Реализовать AJAX-отправку формы.

Работа выполняется на базе лабораторной 2 или лабораторной 3 (по выбору студента). Конкретное задание, соответствующее вашему варианту, согласуйте с преподавателем.

## Краткие теоретические сведения

**JavaScript** - 

**AJAX (асинхронный JavaScript и XML)** - технология для генерации содержимого страницы без полной перезагрузки. Это не самостоятельная технология, а концепция использования нескольких смежных технологий. AJAX базируется на двух основных принципах:
- использование технологии динамического обращения к серверу "на лету", без перезагрузки всей страницы полностью, например:
	- с использованием XMLHttpRequest (основной объект);
	- через динамическое создание дочерних фреймов или окон (например, так реализуется авторизация через социальные сети на различных сайтах);
	- через динамическое создание тега `<script>`;
	- через динамическое создание тега `<img>`, как это реализовано в google analytics.
- использование DHTML для динамического изменения содержания страницы.

Работа технологии AJAX в классическом случае состоит из двух стадий. Первая стадия - это формирование запроса и отправка запроса на сервер. Вторая стадия - это	обработка события на получение ответа от сервера. Данные операции выполняются асинхронно, то есть между стадиями браузер не зависает в ожидании ответа.

**XML** - довольно объемный формат, данные в нем занимают много места, поэтому для передачи данных по сети в современном AJAX используется JSON.

**JSON** - это язык описания данных, основанный на Java Script. Состоит из следующих типов элементов.
- Объект - неупорядоченный набор пар ключ/значение. Объект начинается с `{` (открывающей фигурной скобки) и заканчивается `}` (закрывающей фигурной скобкой). Каждое имя сопровождается `:` (двоеточием), пары ключ/значение разделяются `,` (запятой).
- Массив - упорядоченная коллекция значений. Массив начинается с `[` (открывающей квадратной скобки) и заканчивается `]` (закрывающей квадратной скобкой). Значения разделены `,` (запятой). 
- Значение может быть строкой в двойных кавычках, числом, `true`, `false`, `null`, объектом или массивом. Эти структуры могут быть вложенными. 

**jQuery** - ключевая библиотека JavaScript. Фактически, это библиотека "стандартных" функций языка. Библиотека кроссбраузерная. Библиотека jQuery предназначена прежде всего для удобного поиска и манипулирования элементами на веб-странице. После загрузки страницы библиотека позволяет подключить к элементам дополнительную функциональность. Функция `jQuery` (или `$`) принимает строку, содержащую CSS селектор, которая затем используется для поиска соответствующих элементов.

 [Cheat list jQuery](/mesdt/course/wiki/Cheat-list-jQuery)

Достоинства:
- значительно облегчение манипулированием объектами;
- кросс-браузерная совместимость;
- возможность эффективного разделения разметки и кода на JavaScript;
- огромное сообщество, большое количество плагинов (некоторые не качественные);
- повсеместное использование.

Недостатки:
- дополнительный объем (незначительно для минимизированной версии);
- скорость работы (незначительно для ссовременных браузеров);
- часто - обратная несовместимость на уровне плагинов (плагины оказываются привязаны к узкому диапазону версий, и могут не работать не только на старых версиях библиотеки, но и на новых; часто приходится отказываться от использования плагинов, несовместимых между собой).

## Порядок выполнения

Работа выполняется на базе лабораторной 2 или лабораторной 3 (по выбору студента). В качестве примера рассматривается поиск студента по части фамилии.

Рассмотрим на примере получения списка оценок по id студента.

1. Разработать маршрт и реализовать действие, которое возвращает результат работы в формате json.
	
	На PHP Silex сформировать ответ на языке json можно с момощью соответсвующего метода:
	
	```
	public JsonResponse json(mixed $data = array(), int $status = 200, array $headers = array())
	```
	
	Пример:
	
	```
	$sapp->get('/students/{id}/grades', function ($id) use ($sapp) {
		/**@var $conn Connection */
		$conn = $sapp['db'];
		$subjects = $conn->fetchAll('select * from subjects');
		$scores = $conn->fetchAll('select * from scores where student_id = ?', [$id]);
		$scorez = [];
		foreach ($scores as $score) {
			$scorez[$score['subject_id']] = $score['score'];
		}
		return $sapp->json(array('subjects'=>$subjects,'scorez'=>$scorez));
	});
	```
	
	На Java Spring:
	
	```
	```
	
1. Внести изменения в представления, добавив форму, которая будет отправлять данные с помощью AJAX и получать результат.
1. Подключить jQuery.

	```
	 <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>	
	```
1. Создать свой файл скриптов. С использованием JQuery написать AJAX-запрос.



## Дополнительное задание на повышение рейтинга

## Порядок защиты работы

## Ссылки на скачивание инструментов

## Ссылки на документацию
- [Официальная документация JSON на русском!](http://www.json.org/json-ru.html)
- [jQuery API](http://api.jquery.com/)
- [jQuery AJAX](http://api.jquery.com/jquery.ajax/)
- [Документация по работе с json в PHP Silex](http://silex.sensiolabs.org/doc/cookbook/json_request_body.html)
